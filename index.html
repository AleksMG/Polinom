<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bifid-X RealApp</title>
    <style>
        :root {
            --bg: #0f0f1a;
            --card: #1a1a2e;
            --text: #e0e0ff;
            --accent: #6aff00;
            --error: #ff5e5e;
        }
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .card {
            background: var(--card);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        h1, h2, h3 {
            color: var(--accent);
        }
        button {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 0;
            transition: all 0.2s;
        }
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        textarea, input {
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            border-radius: 4px;
            color: var(--text);
            font-family: inherit;
            margin: 5px 0;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .square {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            margin: 10px 0;
        }
        .square div {
            padding: 8px;
            text-align: center;
            background: rgba(0,0,0,0.2);
            border: 1px solid #333;
        }
        .alert {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: rgba(106, 255, 0, 0.1);
            border-left: 3px solid var(--accent);
        }
        .error {
            background: rgba(255, 94, 94, 0.1);
            border-left: 3px solid var(--error);
        }
        @media (max-width: 600px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>Bifid-X RealApp</h1>
        <p>–£—Å–∏–ª–µ–Ω–Ω—ã–π –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏–π —à–∏—Ñ—Ä–∞—Ç–æ—Ä —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º</p>
    </div>

    <div class="card">
        <h2>üîë –ö–ª—é—á–∏</h2>
        <div class="grid">
            <div>
                <h3>–ö–ª—é—á 1</h3>
                <input id="key1" value="SECRETKEY1" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                <div id="square1" class="square"></div>
            </div>
            <div>
                <h3>–ö–ª—é—á 2</h3>
                <input id="key2" value="SECRETKEY2" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                <div id="square2" class="square"></div>
            </div>
        </div>
        <button onclick="generateSquares()">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç—ã</button>
    </div>

    <div class="card">
        <h2>üîí –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <textarea id="plaintext" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...">ATTACKATDAWN</textarea>
        <button onclick="encrypt()">üîê –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <div id="encrypt-alert" class="alert" style="display:none;"></div>
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <textarea id="ciphertext" rows="4" readonly></textarea>
    </div>

    <div class="card">
        <h2>üîì –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <textarea id="encryptedText" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã..."></textarea>
        <button onclick="decrypt()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <div id="decrypt-alert" class="alert" style="display:none;"></div>
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <textarea id="decryptedText" rows="4" readonly></textarea>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const CHARSET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        const SIZE = 6;
        let square1 = [];
        let square2 = [];

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert(elementId, message, isError = false) {
            const alert = document.getElementById(elementId);
            alert.textContent = message;
            alert.className = `alert ${isError ? 'error' : 'success'}`;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∞–¥—Ä–∞—Ç–∞ —Å –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
        function createSquare(key) {
            const cleanKey = [...new Set(key.toUpperCase().replace(/[^A-Z0-9]/g, ''))];
            
            if (cleanKey.length < 6) {
                showAlert('encrypt-alert', '–ö–ª—é—á –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤', true);
                throw new Error("–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª—é—á");
            }
            
            const remaining = CHARSET.split('').filter(c => !cleanKey.includes(c));
            
            // –ö—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–æ–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
            const shuffled = [...remaining];
            const randomValues = new Uint32Array(shuffled.length);
            crypto.getRandomValues(randomValues);
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = randomValues[i] % (i + 1);
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            const fullChars = [...cleanKey, ...shuffled];
            const square = [];
            
            for (let i = 0; i < SIZE; i++) {
                square.push(fullChars.slice(i * SIZE, (i + 1) * SIZE));
            }
            
            return square;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∞
        function displaySquare(square, elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            for (let row = 0; row < SIZE; row++) {
                for (let col = 0; col < SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.textContent = square[row][col];
                    container.appendChild(cell);
                }
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∞–¥—Ä–∞—Ç–æ–≤
        function generateSquares() {
            try {
                const key1 = document.getElementById('key1').value;
                const key2 = document.getElementById('key2').value;
                
                square1 = createSquare(key1);
                square2 = createSquare(key2);
                
                displaySquare(square1, 'square1');
                displaySquare(square2, 'square2');
                
                showAlert('encrypt-alert', '–ö–≤–∞–¥—Ä–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!');
            } catch (e) {
                console.error(e);
            }
        }

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞
        function encodeChar(char, square, position) {
            for (let row = 0; row < SIZE; row++) {
                for (let col = 0; col < SIZE; col++) {
                    if (square[row][col] === char) {
                        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏
                        const dynamicRow = (row + 1 + position) % SIZE;
                        const dynamicCol = (col + 1 + position) % SIZE;
                        return `${dynamicRow + 1}${dynamicCol + 1}`;
                    }
                }
            }
            return '';
        }

        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function encrypt() {
            try {
                if (square1.length === 0 || square2.length === 0) {
                    showAlert('encrypt-alert', '–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç—ã!', true);
                    return;
                }
                
                const plaintext = document.getElementById('plaintext').value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                
                if (!plaintext) {
                    showAlert('encrypt-alert', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', true);
                    return;
                }
                
                let cipherDigits = '';
                
                for (let i = 0; i < plaintext.length; i++) {
                    const char = plaintext[i];
                    const pos = i + 1;
                    
                    const digits1 = encodeChar(char, square1, pos);
                    const digits2 = encodeChar(char, square2, pos);
                    
                    // XOR –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                    const xorDigit = (parseInt(digits1) ^ parseInt(digits2)).toString().padStart(2, '0');
                    cipherDigits += xorDigit;
                }
                
                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ 4 —Ü–∏—Ñ—Ä—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                document.getElementById('ciphertext').value = cipherDigits.match(/.{1,4}/g).join(' ');
                showAlert('encrypt-alert', '–¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω!');
            } catch (e) {
                showAlert('encrypt-alert', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏: ' + e.message, true);
            }
        }

        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function decrypt() {
            try {
                if (square1.length === 0 || square2.length === 0) {
                    showAlert('decrypt-alert', '–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç—ã!', true);
                    return;
                }
                
                const ciphertext = document.getElementById('encryptedText').value.replace(/\s/g, '');
                
                if (!ciphertext || !/^\d+$/.test(ciphertext)) {
                    showAlert('decrypt-alert', '–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—ã –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏', true);
                    return;
                }
                
                let plaintext = '';
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ 2 —Ü–∏—Ñ—Ä—ã (—Ç–∞–∫ –∫–∞–∫ –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è 2 —Ü–∏—Ñ—Ä–∞–º–∏)
                for (let i = 0; i < ciphertext.length; i += 2) {
                    const digits = ciphertext.substr(i, 2);
                    if (digits.length < 2) break;
                    
                    // –û–±—Ä–∞—Ç–Ω—ã–π XOR
                    const xorValue = parseInt(digits);
                    const pos = (i / 2) + 1;
                    
                    // –ù–∞—Ö–æ–¥–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                    let foundChar = null;
                    
                    for (let row1 = 0; row1 < SIZE && !foundChar; row1++) {
                        for (let col1 = 0; col1 < SIZE && !foundChar; col1++) {
                            const dynamicRow1 = (row1 + 1 + pos) % SIZE;
                            const dynamicCol1 = (col1 + 1 + pos) % SIZE;
                            const code1 = `${dynamicRow1 + 1}${dynamicCol1 + 1}`;
                            
                            for (let row2 = 0; row2 < SIZE && !foundChar; row2++) {
                                for (let col2 = 0; col2 < SIZE && !foundChar; col2++) {
                                    const dynamicRow2 = (row2 + 1 + pos) % SIZE;
                                    const dynamicCol2 = (col2 + 1 + pos) % SIZE;
                                    const code2 = `${dynamicRow2 + 1}${dynamicCol2 + 1}`;
                                    
                                    if ((parseInt(code1) ^ parseInt(code2)) === xorValue) {
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏–º–≤–æ–ª –æ–¥–∏–Ω–∞–∫–æ–≤ –≤ –æ–±–æ–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–∞—Ö
                                        if (square1[row1][col1] === square2[row2][col2]) {
                                            foundChar = square1[row1][col1];
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    plaintext += foundChar || 'ÔøΩ';
                }
                
                document.getElementById('decryptedText').value = plaintext;
                showAlert('decrypt-alert', '–¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!');
            } catch (e) {
                showAlert('decrypt-alert', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ: ' + e.message, true);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            generateSquares();
        };
    </script>
</body>
</html>
