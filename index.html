<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Cipher Pro</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --dark: #2d3436;
            --light: #dfe6e9;
            --error: #d63031;
            --warning: #fdcb6e;
            --success: #00b894;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--dark);
            color: var(--light);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(45, 52, 54, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 25px;
            font-size: 2rem;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        input:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.3);
            outline: none;
        }
        .length-counter {
            font-size: 0.9rem;
            text-align: right;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
        }
        .strength-meter {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        .strength-fill {
            height: 100%;
            width: 0%;
            transition: width 0.3s, background 0.3s;
        }
        button {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border-radius: 10px;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            background: #5649c0;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        button:disabled {
            background: #636e72;
            cursor: not-allowed;
        }
        .result {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            min-height: 100px;
            word-break: break-all;
            font-family: 'Consolas', monospace;
            border: 2px dashed var(--primary);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { border-color: var(--primary); }
            50% { border-color: #a29bfe; }
            100% { border-color: var(--primary); }
        }
        .error {
            color: var(--error);
            margin-top: 10px;
            font-weight: bold;
        }
        .status {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        .valid {
            color: var(--success);
        }
        .invalid {
            color: var(--error);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Secure Cipher Pro</h1>
        
        <div class="input-group">
            <label for="alphabet">–ê–ª—Ñ–∞–≤–∏—Ç (—Ä–æ–≤–Ω–æ 26 –±—É–∫–≤):</label>
            <input type="text" id="alphabet" value="ABCDEFGHIJKLMNOPQRSTUVWXYZ" maxlength="26">
            <div class="status">
                <span id="alphabet-status">–í–≤–µ–¥–∏—Ç–µ 26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—É–∫–≤</span>
                <span class="length-counter"><span id="alphabet-length">0</span>/26</span>
            </div>
        </div>
        
        <div class="input-group">
            <label for="symbols">–°–∏–º–≤–æ–ª—ã —à–∏—Ñ—Ä–∞ (—Ä–æ–≤–Ω–æ 26 –∑–Ω–∞–∫–æ–≤):</label>
            <input type="text" id="symbols" value="‚¥∞‚¥±‚¥≤‚¥≥‚¥¥‚¥µ‚¥∂‚¥∑‚¥∏‚¥π‚¥∫‚¥ª‚¥º‚¥Ω‚¥æ‚¥ø‚µÄ‚µÅ‚µÇ‚µÉ‚µÑ‚µÖ‚µÜ‚µá‚µà" maxlength="26">
            <div class="status">
                <span id="symbols-status">–í–≤–µ–¥–∏—Ç–µ 26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤</span>
                <span class="length-counter"><span id="symbols-length">0</span>/26</span>
            </div>
        </div>
        
        <div class="input-group">
            <label for="key">–ö–ª—é—á:</label>
            <input type="text" id="key" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)">
            <div class="strength-meter">
                <div class="strength-fill" id="strength-fill"></div>
            </div>
            <div class="status">
                <span id="key-status">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–ª—é—á–∞</span>
                <span id="key-length" class="length-counter">0</span>
            </div>
        </div>
        
        <div class="input-group">
            <label for="inputText">–¢–µ–∫—Å—Ç:</label>
            <textarea id="inputText" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
            <div class="length-counter">
                –î–ª–∏–Ω–∞: <span id="text-length">0</span> —Å–∏–º–≤.
                | –®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç: <span id="cipher-length">0</span> —Å–∏–º–≤.
            </div>
        </div>
        
        <button id="encryptBtn" disabled>–®–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <button id="decryptBtn" disabled>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        
        <div class="result" id="outputText">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç...</div>
        <div class="error" id="errorText"></div>
    </div>

    <script>
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const alphabetInput = document.getElementById('alphabet');
        const symbolsInput = document.getElementById('symbols');
        const keyInput = document.getElementById('key');
        const inputText = document.getElementById('inputText');
        const encryptBtn = document.getElementById('encryptBtn');
        const decryptBtn = document.getElementById('decryptBtn');
        const outputText = document.getElementById('outputText');
        const errorText = document.getElementById('errorText');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–∞
        const alphabetStatus = document.getElementById('alphabet-status');
        const symbolsStatus = document.getElementById('symbols-status');
        const keyStatus = document.getElementById('key-status');
        const strengthFill = document.getElementById('strength-fill');
        
        // –°—á–µ—Ç—á–∏–∫–∏ –¥–ª–∏–Ω—ã
        const alphabetLength = document.getElementById('alphabet-length');
        const symbolsLength = document.getElementById('symbols-length');
        const keyLength = document.getElementById('key-length');
        const textLength = document.getElementById('text-length');
        const cipherLength = document.getElementById('cipher-length');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let lastResult = null;
        let isAlphabetValid = false;
        let isSymbolsValid = false;
        let isKeyValid = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª—Ñ–∞–≤–∏—Ç–∞ (26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—É–∫–≤)
        function validateAlphabet() {
            const value = alphabetInput.value.toUpperCase();
            const unique = new Set(value).size;
            
            isAlphabetValid = value.length === 26 && unique === 26 && /^[A-Z]+$/.test(value);
            
            alphabetStatus.textContent = isAlphabetValid 
                ? "‚úÖ –ê–ª—Ñ–∞–≤–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω" 
                : "‚ùå –ù—É–∂–Ω–æ 26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±—É–∫–≤ A-Z";
            alphabetStatus.className = isAlphabetValid ? "valid" : "invalid";
            alphabetLength.textContent = value.length;
            
            updateButtonStates();
            return isAlphabetValid;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ (26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤)
        function validateSymbols() {
            const value = symbolsInput.value;
            const unique = new Set(value).size;
            
            isSymbolsValid = value.length === 26 && unique === 26;
            
            symbolsStatus.textContent = isSymbolsValid 
                ? "‚úÖ –°–∏–º–≤–æ–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã" 
                : "‚ùå –ù—É–∂–Ω–æ 26 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤";
            symbolsStatus.className = isSymbolsValid ? "valid" : "invalid";
            symbolsLength.textContent = value.length;
            
            updateButtonStates();
            return isSymbolsValid;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ (–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)
        function validateKey() {
            const value = keyInput.value;
            let strength = 0;
            
            // –û—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
            if (value.length >= 8) strength += 1;
            if (value.length >= 12) strength += 1;
            if (/[A-Z]/.test(value)) strength += 1;
            if (/[a-z]/.test(value)) strength += 1;
            if (/[0-9]/.test(value)) strength += 1;
            if (/[^A-Za-z0-9]/.test(value)) strength += 1;
            
            // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
            const percent = Math.min(100, strength * 20);
            strengthFill.style.width = percent + '%';
            
            if (strength <= 2) {
                strengthFill.style.background = var(--error);
                keyStatus.textContent = "‚ùå –°–ª–∞–±—ã–π –∫–ª—é—á";
            } else if (strength <= 4) {
                strengthFill.style.background = var(--warning);
                keyStatus.textContent = "‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π –∫–ª—é—á";
            } else {
                strengthFill.style.background = var(--success);
                keyStatus.textContent = "‚úÖ –°–∏–ª—å–Ω—ã–π –∫–ª—é—á";
            }
            
            isKeyValid = value.length >= 8;
            keyLength.textContent = value.length + " —Å–∏–º–≤.";
            
            updateButtonStates();
            return isKeyValid;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
        function updateButtonStates() {
            encryptBtn.disabled = !(isAlphabetValid && isSymbolsValid && isKeyValid);
            decryptBtn.disabled = !(isAlphabetValid && isSymbolsValid && isKeyValid && lastResult);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞
        function updateTextLength() {
            const length = inputText.value.length;
            textLength.textContent = length;
            
            if (lastResult && lastResult.ciphertext) {
                cipherLength.textContent = lastResult.ciphertext.length;
            } else {
                cipherLength.textContent = length;
            }
        }

        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        async function encrypt() {
            try {
                const alphabet = alphabetInput.value.toUpperCase();
                const symbols = symbolsInput.value;
                const key = keyInput.value;
                const text = inputText.value;
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞
                const keystream = await generateKeystream(text.length, key);
                let result = "";
                
                for (let i = 0; i < text.length; i++) {
                    const char = text[i].toUpperCase();
                    const index = alphabet.indexOf(char);
                    
                    if (index === -1) {
                        result += char; // –°–∏–º–≤–æ–ª—ã –≤–Ω–µ –∞–ª—Ñ–∞–≤–∏—Ç–∞ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è
                        continue;
                    }
                    
                    // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
                    const symbolIndex = (index + keystream[i]) % 26;
                    result += symbols[symbolIndex];
                }
                
                lastResult = { ciphertext: result, alphabet, symbols, key };
                outputText.textContent = result;
                errorText.textContent = "";
                updateTextLength();
            } catch (e) {
                errorText.textContent = "–û—à–∏–±–∫–∞: " + e.message;
            }
        }

        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        async function decrypt() {
            try {
                if (!lastResult) throw new Error("–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç");
                
                const { ciphertext, alphabet, symbols, key } = lastResult;
                const keystream = await generateKeystream(ciphertext.length, key);
                let result = "";
                
                for (let i = 0; i < ciphertext.length; i++) {
                    const char = ciphertext[i];
                    const symbolIndex = symbols.indexOf(char);
                    
                    if (symbolIndex === -1) {
                        result += char;
                        continue;
                    }
                    
                    // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
                    const originalIndex = (symbolIndex - keystream[i] + 26) % 26;
                    result += alphabet[originalIndex];
                }
                
                outputText.textContent = result;
                errorText.textContent = "";
            } catch (e) {
                errorText.textContent = "–û—à–∏–±–∫–∞: " + e.message;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞
        async function generateKeystream(length, password) {
            const salt = "fixed_salt_secure";
            const iterations = 100000;
            
            const keyMaterial = await crypto.subtle.importKey(
                "raw",
                new TextEncoder().encode(password),
                { name: "PBKDF2" },
                false,
                ["deriveBits"]
            );
            
            const bits = await crypto.subtle.deriveBits(
                {
                    name: "PBKDF2",
                    salt: new TextEncoder().encode(salt),
                    iterations,
                    hash: "SHA-256"
                },
                keyMaterial,
                length * 32
            );
            
            const view = new DataView(bits);
            const keystream = [];
            
            for (let i = 0; i < length; i++) {
                keystream.push(view.getUint32(i * 4) % 26);
            }
            
            return keystream;
        }

        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
        alphabetInput.addEventListener('input', validateAlphabet);
        symbolsInput.addEventListener('input', validateSymbols);
        keyInput.addEventListener('input', validateKey);
        inputText.addEventListener('input', updateTextLength);
        encryptBtn.addEventListener('click', encrypt);
        decryptBtn.addEventListener('click', decrypt);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        validateAlphabet();
        validateSymbols();
        validateKey();
        updateTextLength();
    </script>
</body>
</html>
